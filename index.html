<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Presensi - SMP Negeri 3 Mlati</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .table-hover:hover { 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }
        .modal { display: none; }
        .modal.active { display: flex; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-modern {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .btn-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        .attendance-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .attendance-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .excel-table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .excel-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            border: 2px solid #5a67d8;
            position: relative;
        }
        .excel-table td {
            padding: 12px;
            border: 1px solid #e2e8f0;
            background: white;
            transition: all 0.2s ease;
        }
        .excel-table tbody tr:nth-child(even) {
            background: #f8fafc;
        }
        .excel-table tbody tr:hover {
            background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .class-badge {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        .gender-badge-l {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        .gender-badge-p {
            background: linear-gradient(135deg, #ed64a6 0%, #d53f8c 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
        }
        .pagination-btn {
            padding: 8px 12px;
            margin: 0 2px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .pagination-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-1px);
        }
        .pagination-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center gradient-bg">
        <div class="card-modern p-8 w-96 glass-effect">
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto mb-4 bg-white rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-graduation-cap text-3xl text-purple-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-white mb-2">SMP Negeri 3 Mlati</h1>
                <p class="text-purple-100">Sistem Presensi Digital</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-white text-sm font-semibold mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border-0 rounded-xl bg-white/20 backdrop-blur text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="Masukkan username" required>
                </div>
                <div class="mb-6">
                    <label class="block text-white text-sm font-semibold mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border-0 rounded-xl bg-white/20 backdrop-blur text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="w-full btn-modern">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
            </form>
            <div class="mt-6 text-xs text-purple-200 text-center space-y-1">
                <p><strong>Demo Admin:</strong> admin / admin123</p>
                <p><strong>Demo Guru:</strong> guru / guru123</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b border-gray-200">
            <div class="flex justify-between items-center px-6 py-4">
                <div class="flex items-center">
                    <button id="sidebarToggle" class="lg:hidden mr-4 p-2 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-bars text-gray-600"></i>
                    </button>
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-graduation-cap text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">SMP Negeri 3 Mlati</h1>
                            <p class="text-sm text-gray-500">Sistem Presensi Digital</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                        <span class="text-gray-700 font-medium" id="welcomeUser">Selamat datang, Admin</span>
                    </div>
                    <button onclick="logout()" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-md">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="bg-white w-64 min-h-screen shadow-sm border-r">
                <nav class="mt-6">
                    <a href="#" onclick="showSection('dashboardSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
                    </a>
                    <a href="#" onclick="showSection('attendanceSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-clipboard-check mr-3"></i>Presensi
                    </a>
                    <a href="#" onclick="showSection('studentsSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-users mr-3"></i>Data Siswa
                    </a>
                    <a href="#" onclick="showSection('classesSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-school mr-3"></i>Data Kelas
                    </a>
                    <a href="#" onclick="showSection('subjectsSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-book mr-3"></i>Mata Pelajaran
                    </a>
                    <a href="#" onclick="showSection('teachersSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-chalkboard-teacher mr-3"></i>Wali Kelas
                    </a>
                    <a href="#" onclick="showSection('reportsSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50">
                        <i class="fas fa-chart-bar mr-3"></i>Laporan
                    </a>
                    <a href="#" onclick="showSection('usersSection')" class="sidebar-item flex items-center px-6 py-3 text-gray-700 hover:bg-blue-50" id="usersMenu" style="display: none;">
                        <i class="fas fa-user-cog mr-3"></i>Kelola Pengguna
                    </a>
                </nav>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-6">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="section">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Dashboard</h2>
                        <p class="text-gray-600">Ringkasan data presensi hari ini</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-full">
                                    <i class="fas fa-users text-blue-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Total Siswa</p>
                                    <p class="text-2xl font-bold text-gray-800" id="totalStudents">480</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-full">
                                    <i class="fas fa-check text-green-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Hadir Hari Ini</p>
                                    <p class="text-2xl font-bold text-gray-800" id="presentToday">442</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 bg-yellow-100 rounded-full">
                                    <i class="fas fa-exclamation text-yellow-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Izin/Sakit</p>
                                    <p class="text-2xl font-bold text-gray-800" id="excusedToday">28</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow">
                            <div class="flex items-center">
                                <div class="p-3 bg-red-100 rounded-full">
                                    <i class="fas fa-times text-red-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-gray-600">Tidak Hadir</p>
                                    <p class="text-2xl font-bold text-gray-800" id="absentToday">10</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Presensi Terbaru</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-2">Kelas</th>
                                        <th class="text-left py-2">Mata Pelajaran</th>
                                        <th class="text-left py-2">Waktu</th>
                                        <th class="text-left py-2">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentAttendance">
                                    <tr class="border-b table-hover">
                                        <td class="py-2">7A</td>
                                        <td class="py-2">Matematika</td>
                                        <td class="py-2">08:00</td>
                                        <td class="py-2"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">Selesai</span></td>
                                    </tr>
                                    <tr class="border-b table-hover">
                                        <td class="py-2">8B</td>
                                        <td class="py-2">Bahasa Indonesia</td>
                                        <td class="py-2">09:00</td>
                                        <td class="py-2"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">Berlangsung</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Attendance Section -->
                <div id="attendanceSection" class="section hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">📋 Presensi Siswa</h2>
                        <p class="text-gray-600">Kelola presensi siswa dengan mudah dan cepat</p>
                    </div>

                    <div class="card-modern p-6 mb-6">
                        <h3 class="text-xl font-semibold mb-6 flex items-center">
                            <i class="fas fa-filter mr-3 text-purple-600"></i>Filter Presensi
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Kelas</label>
                                <select id="attendanceClass" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors">
                                    <option value="">Pilih Kelas</option>
                                    <option value="7A">7A</option>
                                    <option value="7B">7B</option>
                                    <option value="7C">7C</option>
                                    <option value="7D">7D</option>
                                    <option value="8A">8A</option>
                                    <option value="8B">8B</option>
                                    <option value="8C">8C</option>
                                    <option value="8D">8D</option>
                                    <option value="9A">9A</option>
                                    <option value="9B">9B</option>
                                    <option value="9C">9C</option>
                                    <option value="9D">9D</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Mata Pelajaran</label>
                                <select id="attendanceSubject" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors">
                                    <option value="">Pilih Mata Pelajaran</option>
                                    <option value="Matematika">Matematika</option>
                                    <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                                    <option value="IPA">IPA</option>
                                    <option value="IPS">IPS</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Tanggal</label>
                                <input type="date" id="attendanceDate" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors">
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-4 items-center">
                            <button onclick="loadAttendanceList()" class="btn-modern">
                                <i class="fas fa-search mr-2"></i>Tampilkan Daftar Siswa
                            </button>
                            
                            <div class="flex items-center">
                                <input type="checkbox" id="isHoliday" class="mr-2 w-4 h-4 text-purple-600 rounded focus:ring-purple-500">
                                <label for="isHoliday" class="text-sm font-semibold text-gray-700">Tandai sebagai Hari Libur</label>
                            </div>
                        </div>
                    </div>

                    <div id="attendanceList" class="hidden">
                        <div class="card-modern p-6 mb-6">
                            <div class="flex justify-between items-center mb-6">
                                <div>
                                    <h3 class="text-xl font-semibold flex items-center">
                                        <i class="fas fa-users mr-3 text-purple-600"></i>Daftar Siswa
                                    </h3>
                                    <p class="text-gray-600 mt-1" id="attendanceInfo">Kelas: - | Mata Pelajaran: - | Tanggal: -</p>
                                </div>
                                <button onclick="saveAttendance()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-lg">
                                    <i class="fas fa-save mr-2"></i>Simpan Presensi
                                </button>
                            </div>
                            
                            <!-- Search and Bulk Actions -->
                            <div class="bg-gray-50 rounded-xl p-4 mb-6">
                                <div class="flex flex-wrap gap-4 items-center">
                                    <div class="flex-1 min-w-64">
                                        <input type="text" id="searchAttendanceStudent" placeholder="🔍 Cari nama siswa..." class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors" onkeyup="filterAttendanceStudents()">
                                    </div>
                                    
                                    <div class="flex gap-2">
                                        <button onclick="markAllPresent()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md text-sm">
                                            <i class="fas fa-check-double mr-2"></i>Semua Hadir
                                        </button>
                                        
                                        <button onclick="markAllAbsent()" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-md text-sm">
                                            <i class="fas fa-times-circle mr-2"></i>Semua Alpha
                                        </button>
                                        
                                        <button onclick="resetAllAttendance()" class="bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-lg hover:from-gray-600 hover:to-gray-700 transition-all duration-200 shadow-md text-sm">
                                            <i class="fas fa-undo mr-2"></i>Reset
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="grid gap-4" id="studentAttendanceGrid">
                                <!-- Dynamic content will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Students Section -->
                <div id="studentsSection" class="section hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">👥 Data Siswa</h2>
                        <p class="text-gray-600">Kelola data siswa dengan fitur lengkap</p>
                    </div>

                    <div class="card-modern p-6 mb-6">
                        <div class="flex flex-wrap gap-4 mb-4">
                            <button onclick="showModal('addStudentModal')" class="btn-modern">
                                <i class="fas fa-plus mr-2"></i>Tambah Siswa
                            </button>
                            <button onclick="showModal('importStudentModal')" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-md">
                                <i class="fas fa-file-import mr-2"></i>Import Excel
                            </button>
                            <button onclick="exportStudentsExcel()" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-2 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md">
                                <i class="fas fa-file-excel mr-2"></i>Export Excel
                            </button>
                            <button onclick="downloadTemplate()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all duration-200 shadow-md">
                                <i class="fas fa-download mr-2"></i>Template Excel
                            </button>
                            <button onclick="deleteAllStudents()" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-4 py-2 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-md">
                                <i class="fas fa-trash-alt mr-2"></i>Hapus Semua
                            </button>
                        </div>
                        
                        <div class="flex flex-wrap gap-4 items-center">
                            <input type="text" id="searchStudent" placeholder="🔍 Cari siswa (nama, NISN, kelas)..." class="border-2 border-gray-200 rounded-xl px-4 py-3 flex-1 min-w-64 focus:border-purple-500 focus:outline-none transition-colors">
                            <select id="studentsPerPage" onchange="changeStudentsPerPage()" class="border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors">
                                <option value="10">10 per halaman</option>
                                <option value="25" selected>25 per halaman</option>
                                <option value="50">50 per halaman</option>
                                <option value="100">100 per halaman</option>
                            </select>
                        </div>
                    </div>

                    <div class="card-modern">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-semibold flex items-center">
                                    <i class="fas fa-table mr-3 text-purple-600"></i>Daftar Siswa
                                </h3>
                                <div class="text-sm text-gray-600" id="studentsInfo">
                                    Menampilkan 1-25 dari 480 siswa
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="excel-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 60px;">No</th>
                                            <th style="width: 120px;">NISN</th>
                                            <th style="width: 200px;">Nama Lengkap</th>
                                            <th style="width: 80px;">Kelas</th>
                                            <th style="width: 100px;">Jenis Kelamin</th>
                                            <th style="width: 250px;">Alamat</th>
                                            <th style="width: 120px;" class="text-center">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentsList">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <div class="flex justify-between items-center mt-6">
                                <div class="text-sm text-gray-600" id="paginationInfo">
                                    Halaman 1 dari 20
                                </div>
                                <div class="flex items-center space-x-2" id="paginationControls">
                                    <!-- Dynamic pagination buttons -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Classes Section -->
                <div id="classesSection" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Data Kelas</h2>
                        <p class="text-gray-600">Kelola data kelas</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <button onclick="showModal('addClassModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Kelas
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div id="classesList">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>

                <!-- Subjects Section -->
                <div id="subjectsSection" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Mata Pelajaran</h2>
                        <p class="text-gray-600">Kelola mata pelajaran</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <button onclick="showModal('addSubjectModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Mata Pelajaran
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left py-2">Kode</th>
                                            <th class="text-left py-2">Nama Mata Pelajaran</th>
                                            <th class="text-left py-2">Guru Pengampu</th>
                                            <th class="text-center py-2">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="subjectsList">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Teachers Section -->
                <div id="teachersSection" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Wali Kelas</h2>
                        <p class="text-gray-600">Kelola data wali kelas</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <button onclick="showModal('addTeacherModal')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>Tambah Wali Kelas
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="text-left py-2">NIP</th>
                                            <th class="text-left py-2">Nama</th>
                                            <th class="text-left py-2">Kelas</th>
                                            <th class="text-left py-2">No. Telepon</th>
                                            <th class="text-center py-2">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teachersList">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reportsSection" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Laporan Presensi</h2>
                        <p class="text-gray-600">Generate dan ekspor laporan</p>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4">Filter Laporan</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <select id="reportClass" class="border rounded-lg px-3 py-2">
                                <option value="">Semua Kelas</option>
                                <option value="7A">7A</option>
                                <option value="7B">7B</option>
                                <option value="7C">7C</option>
                                <option value="7D">7D</option>
                                <option value="8A">8A</option>
                                <option value="8B">8B</option>
                                <option value="8C">8C</option>
                                <option value="8D">8D</option>
                                <option value="9A">9A</option>
                                <option value="9B">9B</option>
                                <option value="9C">9C</option>
                                <option value="9D">9D</option>
                            </select>
                            <input type="date" id="reportStartDate" class="border rounded-lg px-3 py-2">
                            <input type="date" id="reportEndDate" class="border rounded-lg px-3 py-2">
                            <button onclick="generateReport()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-search mr-2"></i>Generate
                            </button>
                        </div>
                        <div class="flex gap-4">
                            <button onclick="exportExcel()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                <i class="fas fa-file-excel mr-2"></i>Export Excel
                            </button>
                            <button onclick="exportPDF()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-file-pdf mr-2"></i>Export PDF
                            </button>
                        </div>
                    </div>

                    <div id="reportResult" class="bg-white rounded-lg shadow p-6 hidden">
                        <h3 class="text-lg font-semibold mb-4">Hasil Laporan</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left py-2">NISN</th>
                                        <th class="text-left py-2">Nama</th>
                                        <th class="text-left py-2">Kelas</th>
                                        <th class="text-center py-2">Hadir</th>
                                        <th class="text-center py-2">Izin</th>
                                        <th class="text-center py-2">Sakit</th>
                                        <th class="text-center py-2">Alpha</th>
                                        <th class="text-center py-2">Persentase</th>
                                    </tr>
                                </thead>
                                <tbody id="reportData">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="usersSection" class="section hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">👥 Kelola Pengguna</h2>
                        <p class="text-gray-600">Kelola akun admin dan guru</p>
                    </div>

                    <div class="card-modern p-6 mb-6">
                        <button onclick="showModal('addUserModal')" class="btn-modern">
                            <i class="fas fa-plus mr-2"></i>Tambah Pengguna
                        </button>
                    </div>

                    <div class="card-modern">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-4 flex items-center">
                                <i class="fas fa-users mr-3 text-purple-600"></i>Daftar Pengguna
                            </h3>
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b-2 border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold">Username</th>
                                            <th class="text-left py-3 px-4 font-semibold">Nama Lengkap</th>
                                            <th class="text-left py-3 px-4 font-semibold">Role</th>
                                            <th class="text-left py-3 px-4 font-semibold">Status</th>
                                            <th class="text-center py-3 px-4 font-semibold">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersList">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Siswa</h3>
                <button onclick="hideModal('addStudentModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addStudentForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">NISN</label>
                    <input type="text" id="studentNISN" class="w-full border rounded-lg px-3 py-2" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Nama Lengkap</label>
                    <input type="text" id="studentName" class="w-full border rounded-lg px-3 py-2" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Kelas</label>
                    <select id="studentClass" class="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Pilih Kelas</option>
                        <option value="7A">7A</option>
                        <option value="7B">7B</option>
                        <option value="7C">7C</option>
                        <option value="7D">7D</option>
                        <option value="8A">8A</option>
                        <option value="8B">8B</option>
                        <option value="8C">8C</option>
                        <option value="8D">8D</option>
                        <option value="9A">9A</option>
                        <option value="9B">9B</option>
                        <option value="9C">9C</option>
                        <option value="9D">9D</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Jenis Kelamin</label>
                    <select id="studentGender" class="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Pilih</option>
                        <option value="L">Laki-laki</option>
                        <option value="P">Perempuan</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Alamat</label>
                    <textarea id="studentAddress" class="w-full border rounded-lg px-3 py-2" rows="3"></textarea>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('addStudentModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Student Modal -->
    <div id="importStudentModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-[500px] max-w-90vw card-modern">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-file-import mr-3 text-green-600"></i>Import Data Siswa
                </h3>
                <button onclick="hideModal('importStudentModal')" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h4 class="font-semibold text-blue-800 mb-2">📋 Format File Excel/CSV:</h4>
                <div class="text-sm text-blue-700 space-y-1">
                    <p><strong>Kolom A:</strong> Nama Lengkap</p>
                    <p><strong>Kolom B:</strong> Kelas (7A, 7B, 8A, dst)</p>
                    <p><strong>Kolom C:</strong> NISN (10 digit)</p>
                    <p><strong>Kolom D:</strong> Jenis Kelamin (L/P)</p>
                    <p><strong>Kolom E:</strong> Alamat</p>
                </div>
                <div class="mt-3 p-3 bg-white rounded border">
                    <p class="text-xs text-gray-600 mb-2"><strong>Contoh data:</strong></p>
                    <table class="text-xs w-full border-collapse">
                        <tr class="border-b">
                            <td class="border-r px-2 py-1">Ahmad Rizki</td>
                            <td class="border-r px-2 py-1">7A</td>
                            <td class="border-r px-2 py-1">1234567890</td>
                            <td class="border-r px-2 py-1">L</td>
                            <td class="px-2 py-1">Jl. Mawar No. 1</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <form id="importStudentForm">
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Pilih File Excel/CSV</label>
                    <input type="file" id="importFile" accept=".csv,.xlsx,.xls" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-green-500 focus:outline-none transition-colors" required>
                    <p class="text-xs text-gray-500 mt-2">💡 Download template terlebih dahulu untuk format yang benar!</p>
                </div>
                
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('importStudentModal')" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl hover:bg-gray-400 transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 shadow-lg">
                        <i class="fas fa-upload mr-2"></i>Import Data
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Class Modal -->
    <div id="addClassModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Kelas</h3>
                <button onclick="hideModal('addClassModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addClassForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Nama Kelas</label>
                    <input type="text" id="className" class="w-full border rounded-lg px-3 py-2" placeholder="Contoh: 7A" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Tingkat</label>
                    <select id="classLevel" class="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Pilih Tingkat</option>
                        <option value="7">Kelas 7</option>
                        <option value="8">Kelas 8</option>
                        <option value="9">Kelas 9</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Kapasitas</label>
                    <input type="number" id="classCapacity" class="w-full border rounded-lg px-3 py-2" placeholder="32" required>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('addClassModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div id="addSubjectModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Mata Pelajaran</h3>
                <button onclick="hideModal('addSubjectModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addSubjectForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Kode Mata Pelajaran</label>
                    <input type="text" id="subjectCode" class="w-full border rounded-lg px-3 py-2" placeholder="MTK" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Nama Mata Pelajaran</label>
                    <input type="text" id="subjectName" class="w-full border rounded-lg px-3 py-2" placeholder="Matematika" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Guru Pengampu</label>
                    <input type="text" id="subjectTeacher" class="w-full border rounded-lg px-3 py-2" placeholder="Nama Guru" required>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('addSubjectModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div id="addTeacherModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Tambah Wali Kelas</h3>
                <button onclick="hideModal('addTeacherModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addTeacherForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">NIP</label>
                    <input type="text" id="teacherNIP" class="w-full border rounded-lg px-3 py-2" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Nama Lengkap</label>
                    <input type="text" id="teacherName" class="w-full border rounded-lg px-3 py-2" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Kelas</label>
                    <select id="teacherClass" class="w-full border rounded-lg px-3 py-2" required>
                        <option value="">Pilih Kelas</option>
                        <option value="7A">7A</option>
                        <option value="7B">7B</option>
                        <option value="7C">7C</option>
                        <option value="7D">7D</option>
                        <option value="8A">8A</option>
                        <option value="8B">8B</option>
                        <option value="8C">8C</option>
                        <option value="8D">8D</option>
                        <option value="9A">9A</option>
                        <option value="9B">9B</option>
                        <option value="9C">9C</option>
                        <option value="9D">9D</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">No. Telepon</label>
                    <input type="text" id="teacherPhone" class="w-full border rounded-lg px-3 py-2">
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('addTeacherModal')" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 w-96 max-w-90vw card-modern">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-user-plus mr-3 text-purple-600"></i>Tambah Pengguna
                </h3>
                <button onclick="hideModal('addUserModal')" class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addUserForm">
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                    <input type="text" id="userUsername" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                    <input type="password" id="userPassword" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors" required>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="userFullName" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Role</label>
                    <select id="userRole" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-purple-500 focus:outline-none transition-colors" required>
                        <option value="">Pilih Role</option>
                        <option value="admin">Admin</option>
                        <option value="guru">Guru</option>
                    </select>
                </div>
                <div class="flex gap-4">
                    <button type="button" onclick="hideModal('addUserModal')" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl hover:bg-gray-400 transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 btn-modern">
                        Simpan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data
        let users = [
            {username: 'admin', password: 'admin123', fullName: 'Administrator', role: 'admin', status: 'active'},
            {username: 'guru', password: 'guru123', fullName: 'Guru Demo', role: 'guru', status: 'active'}
        ];

        let currentUser = null;

        // Generate 480 dummy students
        function generateDummyStudents() {
            const firstNames = [
                'Ahmad', 'Siti', 'Budi', 'Dewi', 'Eko', 'Fitri', 'Galih', 'Hani', 'Indra', 'Joko',
                'Kartika', 'Lina', 'Made', 'Nita', 'Omar', 'Putri', 'Qori', 'Rina', 'Sari', 'Tono',
                'Umar', 'Vina', 'Wati', 'Xena', 'Yudi', 'Zara', 'Andi', 'Bayu', 'Citra', 'Dani',
                'Erna', 'Fajar', 'Gita', 'Hendra', 'Ika', 'Jihan', 'Kiki', 'Luki', 'Maya', 'Nanda'
            ];
            
            const lastNames = [
                'Pratama', 'Sari', 'Wijaya', 'Putri', 'Santoso', 'Wati', 'Kusuma', 'Dewi', 'Nugroho', 'Lestari',
                'Setiawan', 'Maharani', 'Permana', 'Anggraini', 'Saputra', 'Rahayu', 'Firmansyah', 'Safitri',
                'Kurniawan', 'Handayani', 'Purnomo', 'Suryani', 'Hidayat', 'Pertiwi', 'Ramadhan', 'Novita',
                'Susanto', 'Melati', 'Hakim', 'Indah', 'Rizki', 'Cahaya', 'Bahari', 'Mulia', 'Jaya', 'Sinta'
            ];
            
            const streets = [
                'Jl. Mawar', 'Jl. Melati', 'Jl. Anggrek', 'Jl. Kenanga', 'Jl. Dahlia', 'Jl. Sakura',
                'Jl. Flamboyan', 'Jl. Cempaka', 'Jl. Bougenville', 'Jl. Kamboja', 'Jl. Teratai',
                'Jl. Merpati', 'Jl. Elang', 'Jl. Rajawali', 'Jl. Garuda', 'Jl. Kutilang',
                'Jl. Diponegoro', 'Jl. Sudirman', 'Jl. Gatot Subroto', 'Jl. Ahmad Yani'
            ];
            
            const classes = ['7A', '7B', '7C', '7D', '8A', '8B', '8C', '8D', '9A', '9B', '9C', '9D'];
            const genders = ['L', 'P'];
            
            const students = [];
            let nisnCounter = 2024000001;
            
            // Generate 40 students per class (480 total)
            classes.forEach(className => {
                for (let i = 0; i < 40; i++) {
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    const street = streets[Math.floor(Math.random() * streets.length)];
                    const houseNumber = Math.floor(Math.random() * 100) + 1;
                    
                    students.push({
                        nisn: nisnCounter.toString(),
                        name: `${firstName} ${lastName}`,
                        class: className,
                        gender: genders[Math.floor(Math.random() * genders.length)],
                        address: `${street} No. ${houseNumber}`
                    });
                    
                    nisnCounter++;
                }
            });
            
            return students;
        }

        let students = generateDummyStudents();

        let classes = [
            {name: '7A', level: '7', capacity: 40, current: 40},
            {name: '7B', level: '7', capacity: 40, current: 40},
            {name: '7C', level: '7', capacity: 40, current: 40},
            {name: '7D', level: '7', capacity: 40, current: 40},
            {name: '8A', level: '8', capacity: 40, current: 40},
            {name: '8B', level: '8', capacity: 40, current: 40},
            {name: '8C', level: '8', capacity: 40, current: 40},
            {name: '8D', level: '8', capacity: 40, current: 40},
            {name: '9A', level: '9', capacity: 40, current: 40},
            {name: '9B', level: '9', capacity: 40, current: 40},
            {name: '9C', level: '9', capacity: 40, current: 40},
            {name: '9D', level: '9', capacity: 40, current: 40}
        ];

        let subjects = [
            {code: 'MTK', name: 'Matematika', teacher: 'Drs. Agus Wijaya'},
            {code: 'BIN', name: 'Bahasa Indonesia', teacher: 'Siti Aminah, S.Pd'},
            {code: 'IPA', name: 'Ilmu Pengetahuan Alam', teacher: 'Dr. Bambang Sutrisno'},
            {code: 'IPS', name: 'Ilmu Pengetahuan Sosial', teacher: 'Dra. Retno Wulandari'},
            {code: 'BING', name: 'Bahasa Inggris', teacher: 'Sarah Johnson, M.Ed'}
        ];

        let teachers = [
            {nip: '196501011990031001', name: 'Drs. Agus Wijaya', class: '7A', phone: '081234567890'},
            {nip: '196502021990032002', name: 'Siti Aminah, S.Pd', class: '7B', phone: '081234567891'},
            {nip: '196503031990033003', name: 'Dr. Bambang Sutrisno', class: '8A', phone: '081234567892'},
            {nip: '196504041990034004', name: 'Dra. Retno Wulandari', class: '8B', phone: '081234567893'}
        ];

        let attendanceData = {};

        // Pagination variables
        let currentPage = 1;
        let studentsPerPage = 25;
        let filteredStudents = [...students];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('attendanceDate').value = today;
            document.getElementById('reportStartDate').value = today;
            document.getElementById('reportEndDate').value = today;

            // Load initial data
            loadStudents();
            loadClasses();
            loadSubjects();
            loadTeachers();
            loadUsers();
            updateDashboardStats();
        });

        // Update dashboard statistics
        function updateDashboardStats() {
            document.getElementById('totalStudents').textContent = students.length;
        }

        // Authentication
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password && u.status === 'active');
            
            if (user) {
                currentUser = user;
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('welcomeUser').textContent = `Selamat datang, ${user.fullName}`;
                
                // Show/hide menu based on role
                if (user.role === 'admin') {
                    document.getElementById('usersMenu').style.display = 'block';
                } else {
                    document.getElementById('usersMenu').style.display = 'none';
                }
                
                showSection('dashboardSection');
            } else {
                alert('Username atau password salah!');
            }
        });

        function logout() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Remove active class from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('sidebar-active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Add active class to clicked sidebar item
            event.target.classList.add('sidebar-active');
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Students management with pagination
        function loadStudents() {
            const tbody = document.getElementById('studentsList');
            tbody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const studentsToShow = filteredStudents.slice(startIndex, endIndex);
            
            studentsToShow.forEach((student, index) => {
                const globalIndex = startIndex + index + 1;
                const genderBadge = student.gender === 'L' ? 
                    '<span class="gender-badge-l">Laki-laki</span>' : 
                    '<span class="gender-badge-p">Perempuan</span>';
                
                const row = `
                    <tr>
                        <td class="text-center font-semibold">${globalIndex}</td>
                        <td class="font-mono">${student.nisn}</td>
                        <td class="font-semibold">${student.name}</td>
                        <td class="text-center"><span class="class-badge">${student.class}</span></td>
                        <td class="text-center">${genderBadge}</td>
                        <td>${student.address}</td>
                        <td class="text-center">
                            <button onclick="editStudent('${student.nisn}')" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-3 py-1 rounded-lg text-sm hover:from-yellow-600 hover:to-yellow-700 mr-1 transition-all duration-200">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteStudent('${student.nisn}')" class="bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-1 rounded-lg text-sm hover:from-red-600 hover:to-red-700 transition-all duration-200">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            updatePagination();
            updateStudentsInfo();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            const paginationControls = document.getElementById('paginationControls');
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage - 1})">
                    <i class="fas fa-chevron-left"></i>
                </button>`;
            }
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage(1)">1</button>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-2">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-2">...</span>`;
                }
                paginationHTML += `<button class="pagination-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            if (currentPage < totalPages) {
                paginationHTML += `<button class="pagination-btn" onclick="changePage(${currentPage + 1})">
                    <i class="fas fa-chevron-right"></i>
                </button>`;
            }
            
            paginationControls.innerHTML = paginationHTML;
            
            // Update pagination info
            document.getElementById('paginationInfo').textContent = `Halaman ${currentPage} dari ${totalPages}`;
        }

        function updateStudentsInfo() {
            const startIndex = (currentPage - 1) * studentsPerPage + 1;
            const endIndex = Math.min(currentPage * studentsPerPage, filteredStudents.length);
            document.getElementById('studentsInfo').textContent = 
                `Menampilkan ${startIndex}-${endIndex} dari ${filteredStudents.length} siswa`;
        }

        function changePage(page) {
            currentPage = page;
            loadStudents();
        }

        function changeStudentsPerPage() {
            studentsPerPage = parseInt(document.getElementById('studentsPerPage').value);
            currentPage = 1;
            loadStudents();
        }

        // Search functionality
        document.getElementById('searchStudent').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm) ||
                student.nisn.includes(searchTerm) ||
                student.class.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            loadStudents();
        });

        // Delete all students function
        function deleteAllStudents() {
            if (confirm('⚠️ PERINGATAN!\n\nApakah Anda yakin ingin menghapus SEMUA data siswa?\n\nTindakan ini tidak dapat dibatalkan!')) {
                if (confirm('🚨 KONFIRMASI TERAKHIR!\n\nSemua data siswa (480 siswa) akan dihapus permanen.\n\nKlik OK untuk melanjutkan atau Cancel untuk membatalkan.')) {
                    // Show loading
                    const button = event.target;
                    const originalText = button.innerHTML;
                    button.innerHTML = '<div class="loading"></div> Menghapus...';
                    button.disabled = true;
                    
                    setTimeout(() => {
                        students = [];
                        filteredStudents = [];
                        currentPage = 1;
                        loadStudents();
                        updateDashboardStats();
                        
                        // Reset button
                        button.innerHTML = originalText;
                        button.disabled = false;
                        
                        alert('✅ Semua data siswa berhasil dihapus!');
                    }, 1500);
                }
            }
        }

        // Export students to Excel
        function exportStudentsExcel() {
            if (students.length === 0) {
                alert('Tidak ada data siswa untuk diekspor!');
                return;
            }
            
            // Show loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div> Mengekspor...';
            button.disabled = true;
            
            setTimeout(() => {
                // Create proper Excel HTML format with styling
                let htmlContent = `
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            table { border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; }
                            th, td { border: 1px solid #000; padding: 8px; text-align: left; }
                            th { background-color: #4472C4; color: white; font-weight: bold; text-align: center; }
                            .number { text-align: center; }
                            .header { text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 20px; }
                        </style>
                    </head>
                    <body>
                        <div class="header">DATA SISWA SMP NEGERI 3 MLATI</div>
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 50px;">No</th>
                                    <th style="width: 120px;">NISN</th>
                                    <th style="width: 200px;">Nama Lengkap</th>
                                    <th style="width: 80px;">Kelas</th>
                                    <th style="width: 120px;">Jenis Kelamin</th>
                                    <th style="width: 250px;">Alamat</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                students.forEach((student, index) => {
                    const genderText = student.gender === 'L' ? 'Laki-laki' : 'Perempuan';
                    htmlContent += `
                        <tr>
                            <td class="number">${index + 1}</td>
                            <td>${student.nisn}</td>
                            <td>${student.name}</td>
                            <td class="number">${student.class}</td>
                            <td>${genderText}</td>
                            <td>${student.address}</td>
                        </tr>
                    `;
                });
                
                htmlContent += `
                            </tbody>
                        </table>
                        <br><br>
                        <div style="font-size: 12px; color: #666;">
                            Diekspor pada: ${new Date().toLocaleString('id-ID')}<br>
                            Total Siswa: ${students.length} orang
                        </div>
                    </body>
                    </html>
                `;
                
                // Create and download file
                const blob = new Blob([htmlContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `Data_Siswa_SMP_Negeri_3_Mlati_${new Date().toISOString().split('T')[0]}.xls`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                alert('📊 Data siswa berhasil diekspor ke Excel dengan format tabel rapi!');
            }, 1000);
        }

document.getElementById('addStudentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const newStudent = {
        nisn: document.getElementById('studentNISN').value,
        name: document.getElementById('studentName').value,
        class: document.getElementById('studentClass').value,
        gender: document.getElementById('studentGender').value,
        address: document.getElementById('studentAddress').value
    };
    
    // Cek duplikat NISN
    if (students.find(s => s.nisn === newStudent.nisn)) {
        alert('❌ NISN sudah terdaftar!');
        return;
    }
    
    students.push(newStudent);
    filteredStudents = [...students];
    loadStudents();
    updateDashboardStats();
    hideModal('addStudentModal');
    this.reset();
    alert('✅ Siswa berhasil ditambahkan!');
});

// Event listener form import siswa (Excel/CSV)
document.getElementById('importStudentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const fileInput = document.getElementById('importFile');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('❌ Mohon pilih file Excel (.xlsx) atau CSV!');
        return;
    }
    
    // Tombol loading
    const button = this.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    button.innerHTML = '<div class="loading"></div> Mengimpor...';
    button.disabled = true;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 }); // array of array

            let importedCount = 0, duplicateCount = 0, errorCount = 0;

            // Deteksi apakah file hanya punya 1 baris tanpa header
            let startIndex = 1;
            if (rows.length === 1) {
                startIndex = 0; // anggap baris pertama sebagai data, bukan header
            }

            for (let i = startIndex; i < rows.length; i++) {
                const row = rows[i];
                if (!row || row.length < 5) {
                    errorCount++;
                    continue;
                }

                const newStudent = {
                    name: row[0],
                    class: row[1],
                    nisn: row[2],
                    gender: row[3]?.toString().toUpperCase(),
                    address: row[4]
                };

                // Validasi data
                if (!newStudent.nisn || !newStudent.name || !newStudent.class) {
                    errorCount++;
                    continue;
                }

                // Cek duplikat NISN
                if (students.find(s => s.nisn === newStudent.nisn)) {
                    duplicateCount++;
                    continue;
                }

                students.push(newStudent);
                importedCount++;
            }

            // Refresh tampilan
            filteredStudents = [...students];
            loadStudents();
            updateDashboardStats();
            hideModal('importStudentModal');

            // Reset tombol
            button.innerHTML = originalText;
            button.disabled = false;

            // Hasil
            let message = `📊 Hasil Import:\n\n`;
            message += `✅ Berhasil diimpor: ${importedCount} siswa\n`;
            if (duplicateCount > 0) message += `⚠️ Duplikat (dilewati): ${duplicateCount} siswa\n`;
            if (errorCount > 0) message += `❌ Error (data tidak valid): ${errorCount} baris\n`;

            alert(message);

        } catch (error) {
            console.error(error);
            button.innerHTML = originalText;
            button.disabled = false;
            alert('❌ Error membaca file. Pastikan format sesuai template!');
        }
    };

    // Bisa baca CSV & Excel
    reader.readAsArrayBuffer(file);
});
            


        function editStudent(nisn) {
            const student = students.find(s => s.nisn === nisn);
            if (student) {
                document.getElementById('studentNISN').value = student.nisn;
                document.getElementById('studentName').value = student.name;
                document.getElementById('studentClass').value = student.class;
                document.getElementById('studentGender').value = student.gender;
                document.getElementById('studentAddress').value = student.address;
                showModal('addStudentModal');
            }
        }

        function deleteStudent(nisn) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                students = students.filter(s => s.nisn !== nisn);
                filteredStudents = [...students];
                loadStudents();
                updateDashboardStats();
                alert('✅ Siswa berhasil dihapus!');
            }
        }

        // Classes management
        function loadClasses() {
            const container = document.getElementById('classesList');
            container.innerHTML = '';
            
            classes.forEach(cls => {
                const card = `
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-lg font-semibold">Kelas ${cls.name}</h3>
                            <div class="flex gap-2">
                                <button onclick="editClass('${cls.name}')" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm hover:bg-yellow-600">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteClass('${cls.name}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <p class="text-gray-600">Tingkat: ${cls.level}</p>
                            <p class="text-gray-600">Kapasitas: ${cls.current}/${cls.capacity} siswa</p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${(cls.current/cls.capacity)*100}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        document.getElementById('addClassForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newClass = {
                name: document.getElementById('className').value,
                level: document.getElementById('classLevel').value,
                capacity: parseInt(document.getElementById('classCapacity').value),
                current: 0
            };
            
            classes.push(newClass);
            loadClasses();
            hideModal('addClassModal');
            this.reset();
            alert('Kelas berhasil ditambahkan!');
        });

        function editClass(name) {
            const cls = classes.find(c => c.name === name);
            if (cls) {
                document.getElementById('className').value = cls.name;
                document.getElementById('classLevel').value = cls.level;
                document.getElementById('classCapacity').value = cls.capacity;
                showModal('addClassModal');
            }
        }

        function deleteClass(name) {
            if (confirm('Apakah Anda yakin ingin menghapus kelas ini?')) {
                classes = classes.filter(c => c.name !== name);
                loadClasses();
                alert('Kelas berhasil dihapus!');
            }
        }

        // Subjects management
        function loadSubjects() {
            const tbody = document.getElementById('subjectsList');
            tbody.innerHTML = '';
            
            subjects.forEach(subject => {
                const row = `
                    <tr class="border-b table-hover">
                        <td class="py-2">${subject.code}</td>
                        <td class="py-2">${subject.name}</td>
                        <td class="py-2">${subject.teacher}</td>
                        <td class="py-2 text-center">
                            <button onclick="editSubject('${subject.code}')" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm hover:bg-yellow-600 mr-1">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteSubject('${subject.code}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        document.getElementById('addSubjectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newSubject = {
                code: document.getElementById('subjectCode').value,
                name: document.getElementById('subjectName').value,
                teacher: document.getElementById('subjectTeacher').value
            };
            
            subjects.push(newSubject);
            loadSubjects();
            hideModal('addSubjectModal');
            this.reset();
            alert('Mata pelajaran berhasil ditambahkan!');
        });

        function editSubject(code) {
            const subject = subjects.find(s => s.code === code);
            if (subject) {
                document.getElementById('subjectCode').value = subject.code;
                document.getElementById('subjectName').value = subject.name;
                document.getElementById('subjectTeacher').value = subject.teacher;
                showModal('addSubjectModal');
            }
        }

        function deleteSubject(code) {
            if (confirm('Apakah Anda yakin ingin menghapus mata pelajaran ini?')) {
                subjects = subjects.filter(s => s.code !== code);
                loadSubjects();
                alert('Mata pelajaran berhasil dihapus!');
            }
        }

        // Teachers management
        function loadTeachers() {
            const tbody = document.getElementById('teachersList');
            tbody.innerHTML = '';
            
            teachers.forEach(teacher => {
                const row = `
                    <tr class="border-b table-hover">
                        <td class="py-2">${teacher.nip}</td>
                        <td class="py-2">${teacher.name}</td>
                        <td class="py-2">${teacher.class}</td>
                        <td class="py-2">${teacher.phone}</td>
                        <td class="py-2 text-center">
                            <button onclick="editTeacher('${teacher.nip}')" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm hover:bg-yellow-600 mr-1">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTeacher('${teacher.nip}')" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newTeacher = {
                nip: document.getElementById('teacherNIP').value,
                name: document.getElementById('teacherName').value,
                class: document.getElementById('teacherClass').value,
                phone: document.getElementById('teacherPhone').value
            };
            
            teachers.push(newTeacher);
            loadTeachers();
            hideModal('addTeacherModal');
            this.reset();
            alert('Wali kelas berhasil ditambahkan!');
        });

        function editTeacher(nip) {
            const teacher = teachers.find(t => t.nip === nip);
            if (teacher) {
                document.getElementById('teacherNIP').value = teacher.nip;
                document.getElementById('teacherName').value = teacher.name;
                document.getElementById('teacherClass').value = teacher.class;
                document.getElementById('teacherPhone').value = teacher.phone;
                showModal('addTeacherModal');
            }
        }

        function deleteTeacher(nip) {
            if (confirm('Apakah Anda yakin ingin menghapus wali kelas ini?')) {
                teachers = teachers.filter(t => t.nip !== nip);
                loadTeachers();
                alert('Wali kelas berhasil dihapus!');
            }
        }

        // Attendance management
        let currentAttendanceStudents = [];
        
        function loadAttendanceList() {
            const selectedClass = document.getElementById('attendanceClass').value;
            const selectedSubject = document.getElementById('attendanceSubject').value;
            const selectedDate = document.getElementById('attendanceDate').value;
            const isHoliday = document.getElementById('isHoliday').checked;
            
            if (!selectedClass || !selectedSubject || !selectedDate) {
                alert('Mohon lengkapi semua field!');
                return;
            }
            
            if (isHoliday) {
                if (confirm('Hari ini ditandai sebagai hari libur. Semua siswa akan otomatis ditandai libur. Lanjutkan?')) {
                    alert('✅ Hari libur berhasil disimpan untuk semua siswa!');
                    return;
                }
            }
            
            currentAttendanceStudents = students.filter(s => s.class === selectedClass);
            const info = document.getElementById('attendanceInfo');
            
            // Update info
            info.textContent = `Kelas: ${selectedClass} | Mata Pelajaran: ${selectedSubject} | Tanggal: ${selectedDate}`;
            
            renderAttendanceGrid();
            document.getElementById('attendanceList').classList.remove('hidden');
        }
        
        function renderAttendanceGrid() {
            const grid = document.getElementById('studentAttendanceGrid');
            const searchTerm = document.getElementById('searchAttendanceStudent').value.toLowerCase();
            
            // Filter students based on search
            const filteredStudents = currentAttendanceStudents.filter(student => 
                student.name.toLowerCase().includes(searchTerm)
            );
            
            grid.innerHTML = '';
            
            if (filteredStudents.length === 0) {
                grid.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <p>Tidak ada siswa yang ditemukan dengan kata kunci "${searchTerm}"</p>
                    </div>
                `;
                return;
            }
            
            filteredStudents.forEach((student, index) => {
                const card = `
                    <div class="attendance-card" data-student-nisn="${student.nisn}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold mr-4">
                                    ${index + 1}
                                </div>
                                <div>
                                    <h4 class="font-semibold text-gray-800">${student.name}</h4>
                                    <p class="text-sm text-gray-600">NISN: ${student.nisn}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="status-badge bg-gray-100 text-gray-600" id="status_${student.nisn}">Belum Dipilih</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center p-3 border-2 border-green-200 rounded-lg cursor-pointer hover:bg-green-50 transition-colors">
                                <input type="radio" name="attendance_${student.nisn}" value="hadir" class="mr-2" onchange="updateStatus('${student.nisn}', 'hadir')" checked>
                                <div class="flex items-center">
                                    <i class="fas fa-check text-green-600 mr-2"></i>
                                    <span class="text-green-700 font-medium">Hadir</span>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border-2 border-yellow-200 rounded-lg cursor-pointer hover:bg-yellow-50 transition-colors">
                                <input type="radio" name="attendance_${student.nisn}" value="izin" class="mr-2" onchange="updateStatus('${student.nisn}', 'izin')">
                                <div class="flex items-center">
                                    <i class="fas fa-hand-paper text-yellow-600 mr-2"></i>
                                    <span class="text-yellow-700 font-medium">Izin</span>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border-2 border-blue-200 rounded-lg cursor-pointer hover:bg-blue-50 transition-colors">
                                <input type="radio" name="attendance_${student.nisn}" value="sakit" class="mr-2" onchange="updateStatus('${student.nisn}', 'sakit')">
                                <div class="flex items-center">
                                    <i class="fas fa-thermometer text-blue-600 mr-2"></i>
                                    <span class="text-blue-700 font-medium">Sakit</span>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border-2 border-red-200 rounded-lg cursor-pointer hover:bg-red-50 transition-colors">
                                <input type="radio" name="attendance_${student.nisn}" value="alpha" class="mr-2" onchange="updateStatus('${student.nisn}', 'alpha')">
                                <div class="flex items-center">
                                    <i class="fas fa-times text-red-600 mr-2"></i>
                                    <span class="text-red-700 font-medium">Alpha</span>
                                </div>
                            </label>
                        </div>
                        
                        <div class="mt-4">
                            <input type="text" class="w-full border-2 border-gray-200 rounded-lg px-3 py-2 focus:border-purple-500 focus:outline-none transition-colors" placeholder="Keterangan (opsional)" id="note_${student.nisn}">
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });
            
            // Set initial status for all students
            filteredStudents.forEach(student => {
                updateStatus(student.nisn, 'hadir');
            });
        }
        
        function filterAttendanceStudents() {
            renderAttendanceGrid();
        }
        
        function markAllPresent() {
            if (confirm('Tandai semua siswa sebagai HADIR?')) {
                currentAttendanceStudents.forEach(student => {
                    const radio = document.querySelector(`input[name="attendance_${student.nisn}"][value="hadir"]`);
                    if (radio) {
                        radio.checked = true;
                        updateStatus(student.nisn, 'hadir');
                    }
                });
                alert('✅ Semua siswa berhasil ditandai HADIR!');
            }
        }
        
        function markAllAbsent() {
            if (confirm('Tandai semua siswa sebagai ALPHA (tidak hadir tanpa keterangan)?')) {
                currentAttendanceStudents.forEach(student => {
                    const radio = document.querySelector(`input[name="attendance_${student.nisn}"][value="alpha"]`);
                    if (radio) {
                        radio.checked = true;
                        updateStatus(student.nisn, 'alpha');
                    }
                });
                alert('⚠️ Semua siswa berhasil ditandai ALPHA!');
            }
        }
        
        function resetAllAttendance() {
            if (confirm('Reset semua presensi ke status HADIR?')) {
                currentAttendanceStudents.forEach(student => {
                    const radio = document.querySelector(`input[name="attendance_${student.nisn}"][value="hadir"]`);
                    if (radio) {
                        radio.checked = true;
                        updateStatus(student.nisn, 'hadir');
                    }
                    // Clear notes
                    const noteField = document.getElementById(`note_${student.nisn}`);
                    if (noteField) noteField.value = '';
                });
                alert('🔄 Semua presensi berhasil direset ke HADIR!');
            }
        }

        function updateStatus(nisn, status) {
            const statusElement = document.getElementById(`status_${nisn}`);
            const statusConfig = {
                'hadir': { text: 'Hadir', class: 'bg-green-100 text-green-800' },
                'izin': { text: 'Izin', class: 'bg-yellow-100 text-yellow-800' },
                'sakit': { text: 'Sakit', class: 'bg-blue-100 text-blue-800' },
                'alpha': { text: 'Alpha', class: 'bg-red-100 text-red-800' }
            };
            
            const config = statusConfig[status];
            statusElement.textContent = config.text;
            statusElement.className = `status-badge ${config.class}`;
        }

        function saveAttendance() {
            const selectedClass = document.getElementById('attendanceClass').value;
            const selectedSubject = document.getElementById('attendanceSubject').value;
            const selectedDate = document.getElementById('attendanceDate').value;
            
            // Simulate saving attendance
            alert(`✅ Presensi untuk kelas ${selectedClass} mata pelajaran ${selectedSubject} tanggal ${selectedDate} berhasil disimpan!`);
        }

        // Reports
        function generateReport() {
            const selectedClass = document.getElementById('reportClass').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('Mohon pilih tanggal mulai dan selesai!');
                return;
            }
            
            // Generate sample report data
            const reportStudents = selectedClass ? students.filter(s => s.class === selectedClass) : students;
            const tbody = document.getElementById('reportData');
            tbody.innerHTML = '';
            
            reportStudents.forEach(student => {
                const hadir = Math.floor(Math.random() * 20) + 15;
                const izin = Math.floor(Math.random() * 3);
                const sakit = Math.floor(Math.random() * 2);
                const alpha = Math.floor(Math.random() * 2);
                const total = hadir + izin + sakit + alpha;
                const percentage = ((hadir / total) * 100).toFixed(1);
                
                const row = `
                    <tr class="border-b table-hover">
                        <td class="py-2">${student.nisn}</td>
                        <td class="py-2">${student.name}</td>
                        <td class="py-2">${student.class}</td>
                        <td class="py-2 text-center">${hadir}</td>
                        <td class="py-2 text-center">${izin}</td>
                        <td class="py-2 text-center">${sakit}</td>
                        <td class="py-2 text-center">${alpha}</td>
                        <td class="py-2 text-center">${percentage}%</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            document.getElementById('reportResult').classList.remove('hidden');
        }

function exportExcel() {
    const selectedClass = document.getElementById('reportClass').value;
    const startDate = document.getElementById('reportStartDate').value;
    const endDate = document.getElementById('reportEndDate').value;

    if (!startDate || !endDate) {
        alert('Mohon generate laporan terlebih dahulu!');
        return;
    }

    const reportStudents = selectedClass ? students.filter(s => s.class === selectedClass) : students;

    // Header
    const data = [
        ["NISN", "Nama", "Kelas", "Hadir", "Izin", "Sakit", "Alpha", "Persentase"]
    ];

    // Isi data
    reportStudents.forEach(student => {
        const hadir = Math.floor(Math.random() * 20) + 15;
        const izin = Math.floor(Math.random() * 3);
        const sakit = Math.floor(Math.random() * 2);
        const alpha = Math.floor(Math.random() * 2);
        const total = hadir + izin + sakit + alpha;
        const percentage = ((hadir / total) * 100).toFixed(1) + "%";

        data.push([student.nisn, student.name, student.class, hadir, izin, sakit, alpha, percentage]);
    });

    // Buat worksheet
    const ws = XLSX.utils.aoa_to_sheet(data);

    // Range data
    const range = XLSX.utils.decode_range(ws['!ref']);

    // Styling tiap cell (border + header style)
    for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
            const cellRef = XLSX.utils.encode_cell({ r: R, c: C });
            const cell = ws[cellRef];
            if (cell) {
                // Semua cell kasih border
                cell.s = {
                    border: {
                        top: { style: "thin", color: { rgb: "000000" } },
                        bottom: { style: "thin", color: { rgb: "000000" } },
                        left: { style: "thin", color: { rgb: "000000" } },
                        right: { style: "thin", color: { rgb: "000000" } }
                    }
                };

                // Header (row pertama) -> bold + background
                if (R === 0) {
                    cell.s.fill = { fgColor: { rgb: "D6EAF8" } }; // biru muda
                    cell.s.font = { bold: true, color: { rgb: "000000" } };
                }
            }
        }
    }

    // Auto fit column width
    const colWidths = data[0].map((_, colIndex) =>
        ({ wch: Math.max(...data.map(row => (row[colIndex] ? row[colIndex].toString().length : 0))) + 2 })
    );
    ws['!cols'] = colWidths;

    // Buat workbook & simpan
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Laporan");

    XLSX.writeFile(wb, `Laporan_Presensi_${selectedClass || 'Semua_Kelas'}_${startDate}_${endDate}.xlsx`);

    alert('Laporan berhasil diekspor ke Excel (XLSX) dengan tabel rapi + all border!');
}

        function exportPDF() {
            const selectedClass = document.getElementById('reportClass').value;
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            
            if (!startDate || !endDate) {
                alert('Mohon generate laporan terlebih dahulu!');
                return;
            }
            
            // Get report data
            const reportStudents = selectedClass ? students.filter(s => s.class === selectedClass) : students;
            
            // Create HTML content for PDF
            let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Laporan Presensi</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .school-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
                        .report-title { font-size: 16px; margin-bottom: 10px; }
                        .report-info { font-size: 12px; color: #666; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .text-center { text-align: center; }
                        .footer { margin-top: 30px; font-size: 10px; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="school-name">SMP NEGERI 3 MLATI</div>
                        <div class="report-title">LAPORAN PRESENSI SISWA</div>
                        <div class="report-info">
                            Periode: ${startDate} s/d ${endDate}<br>
                            Kelas: ${selectedClass || 'Semua Kelas'}<br>
                            Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>No</th>
                                <th>NISN</th>
                                <th>Nama Siswa</th>
                                <th>Kelas</th>
                                <th class="text-center">Hadir</th>
                                <th class="text-center">Izin</th>
                                <th class="text-center">Sakit</th>
                                <th class="text-center">Alpha</th>
                                <th class="text-center">Persentase</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            reportStudents.forEach((student, index) => {
                const hadir = Math.floor(Math.random() * 20) + 15;
                const izin = Math.floor(Math.random() * 3);
                const sakit = Math.floor(Math.random() * 2);
                const alpha = Math.floor(Math.random() * 2);
                const total = hadir + izin + sakit + alpha;
                const percentage = ((hadir / total) * 100).toFixed(1);
                
                htmlContent += `
                    <tr>
                        <td class="text-center">${index + 1}</td>
                        <td>${student.nisn}</td>
                        <td>${student.name}</td>
                        <td class="text-center">${student.class}</td>
                        <td class="text-center">${hadir}</td>
                        <td class="text-center">${izin}</td>
                        <td class="text-center">${sakit}</td>
                        <td class="text-center">${alpha}</td>
                        <td class="text-center">${percentage}%</td>
                    </tr>
                `;
            });
            
            htmlContent += `
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>Laporan ini digenerate secara otomatis oleh Sistem Presensi SMP Negeri 3 Mlati</p>
                    </div>
                </body>
                </html>
            `;
            
            // Create and download HTML file (can be opened and printed as PDF)
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Laporan_Presensi_${selectedClass || 'Semua_Kelas'}_${startDate}_${endDate}.html`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Laporan berhasil diekspor ke format HTML! Buka file dan print sebagai PDF.');
        }

        // Download template function
        function downloadTemplate() {
            // Show loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading"></div> Membuat Template...';
            button.disabled = true;
            
            setTimeout(() => {
                // Create proper Excel HTML template with styling and borders
                let htmlContent = `
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <style>
                            table { border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; }
                            th, td { border: 2px solid #000; padding: 10px; text-align: left; }
                            th { background-color: #4472C4; color: white; font-weight: bold; text-align: center; font-size: 12px; }
                            td { font-size: 11px; }
                            .header { text-align: center; font-size: 16px; font-weight: bold; margin-bottom: 20px; color: #4472C4; }
                            .instruction { background-color: #FFF2CC; border: 2px solid #D6B656; padding: 10px; margin-bottom: 20px; font-size: 11px; }
                            .example { background-color: #E7F3FF; }
                        </style>
                    </head>
                    <body>
                        <div class="header">TEMPLATE IMPORT DATA SISWA<br>SMP NEGERI 3 MLATI</div>
                        
                        <div class="instruction">
                            <strong>📋 PETUNJUK PENGGUNAAN:</strong><br>
                            1. Isi data siswa pada baris kosong di bawah contoh<br>
                            2. Jangan mengubah header kolom (baris pertama)<br>
                            3. Jenis Kelamin: gunakan "L" untuk Laki-laki, "P" untuk Perempuan<br>
                            4. Kelas: gunakan format seperti 7A, 7B, 8A, 8B, 9A, 9B, dst<br>
                            5. NISN: harus 10 digit angka<br>
                            6. Simpan file ini dan upload kembali untuk import data
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 200px;">Nama Lengkap<br>(Kolom A)</th>
                                    <th style="width: 80px;">Kelas<br>(Kolom B)</th>
                                    <th style="width: 120px;">NISN<br>(Kolom C)</th>
                                    <th style="width: 120px;">Jenis Kelamin<br>(Kolom D)</th>
                                    <th style="width: 250px;">Alamat<br>(Kolom E)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="example">
                                    <td>Ahmad Rizki Pratama</td>
                                    <td>7A</td>
                                    <td>2024000001</td>
                                    <td>L</td>
                                    <td>Jl. Mawar No. 15, Sleman</td>
                                </tr>
                                <tr class="example">
                                    <td>Siti Nurhaliza Dewi</td>
                                    <td>7A</td>
                                    <td>2024000002</td>
                                    <td>P</td>
                                    <td>Jl. Melati No. 22, Yogyakarta</td>
                                </tr>
                                <tr class="example">
                                    <td>Budi Santoso</td>
                                    <td>7B</td>
                                    <td>2024000003</td>
                                    <td>L</td>
                                    <td>Jl. Anggrek No. 8, Mlati</td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <br><br>
                        <div style="font-size: 10px; color: #666; border-top: 1px solid #ccc; padding-top: 10px;">
                            <strong>Catatan:</strong><br>
                            • Template ini dibuat pada: ${new Date().toLocaleString('id-ID')}<br>
                            • Hapus baris contoh (yang berwarna biru) sebelum mengisi data asli<br>
                            • Maksimal 1000 siswa per file import<br>
                            • Untuk bantuan, hubungi administrator sistem
                        </div>
                    </body>
                    </html>
                `;
                
                const blob = new Blob([htmlContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'Template_Import_Siswa_SMP_Negeri_3_Mlati.xls');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                alert('📋 Template Excel berhasil didownload!\n\n✅ Template sudah memiliki format tabel rapi dengan garis\n✅ Setiap kategori data berada di kolom terpisah\n✅ Dilengkapi petunjuk penggunaan\n✅ Siap untuk diisi dan diupload kembali');
            }, 800);
        }

        // User management
        function loadUsers() {
            const tbody = document.getElementById('usersList');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const statusBadge = user.status === 'active' ? 
                    '<span class="status-badge bg-green-100 text-green-800">Aktif</span>' : 
                    '<span class="status-badge bg-red-100 text-red-800">Nonaktif</span>';
                
                const roleBadge = user.role === 'admin' ? 
                    '<span class="status-badge bg-purple-100 text-purple-800">Admin</span>' : 
                    '<span class="status-badge bg-blue-100 text-blue-800">Guru</span>';
                
                const row = `
                    <tr class="border-b table-hover">
                        <td class="py-3 px-4">${user.username}</td>
                        <td class="py-3 px-4">${user.fullName}</td>
                        <td class="py-3 px-4">${roleBadge}</td>
                        <td class="py-3 px-4">${statusBadge}</td>
                        <td class="py-3 px-4 text-center">
                            <button onclick="editUser('${user.username}')" class="bg-yellow-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-yellow-600 mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="toggleUserStatus('${user.username}')" class="bg-${user.status === 'active' ? 'red' : 'green'}-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-${user.status === 'active' ? 'red' : 'green'}-600">
                                <i class="fas fa-${user.status === 'active' ? 'ban' : 'check'}"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        document.getElementById('addUserForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newUser = {
                username: document.getElementById('userUsername').value,
                password: document.getElementById('userPassword').value,
                fullName: document.getElementById('userFullName').value,
                role: document.getElementById('userRole').value,
                status: 'active'
            };
            
            // Check if username already exists
            if (users.find(u => u.username === newUser.username)) {
                alert('Username sudah digunakan!');
                return;
            }
            
            users.push(newUser);
            loadUsers();
            hideModal('addUserModal');
            this.reset();
            alert('Pengguna berhasil ditambahkan!');
        });

        function editUser(username) {
            const user = users.find(u => u.username === username);
            if (user) {
                document.getElementById('userUsername').value = user.username;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userFullName').value = user.fullName;
                document.getElementById('userRole').value = user.role;
                showModal('addUserModal');
            }
        }

        function toggleUserStatus(username) {
            const user = users.find(u => u.username === username);
            if (user) {
                user.status = user.status === 'active' ? 'inactive' : 'active';
                loadUsers();
                alert(`Status pengguna ${user.fullName} berhasil diubah!`);
            }
        }

        // Sidebar toggle for mobile
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'977324e8f5066008',t:'MTc1NjU0NDkxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
